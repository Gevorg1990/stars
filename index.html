<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue.js Comment System</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
    :root {
  --star-size: 40px;
  --star-color: #fff;
  --star-background: #fc0;
}

.star {
    transition: all 0.3s ease;
}

.Stars {
  --percent: calc(var(--rating) / 5 * 100%);
  background: #eee;
  display: inline-block;
  font-size: var(--star-size);
  line-height: 1;
  
  
}

.Stars:before {
    content: '★★★★★';
    letter-spacing: 1px;
    background: linear-gradient(90deg, var(--star-background) var(--percent), var(--star-color) var(--percent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }



body {
  background: #eee;
 padding: 0;
 margin: 0;
}
        .stars {
            color: gold;
            font-size: 1.2em;
        }
        .star {
            cursor: pointer;
        }
        .filled {
            color: gold;
        }
        .empty {
            color: lightgray;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Comment System</h1>
        <form @submit.prevent="addComment">
            <input type="text" v-model="newComment" placeholder="Enter your comment" required>
            <button type="submit">Add Comment</button>
        </form>

        <!-- Global Rating Display -->
        <div>
            <h2>Global Rating:</h2>
            <div class="stars">
                <span v-for="star in 5" :key="star"
                      class="star"
                      :class="{ filled: star <= tempRating, empty: star > tempRating }"
                      @mouseover="hoverRating(star)"
                      @mouseleave="resetRating"
                      @click="setRating(star)">
                    ★
                </span>
            </div>
            <p>Total Comments: {{ commentCount }}</p>
            <p>Average Rating: {{ averageRating }}</p>
        </div>

        <div>
            <div v-for="(comment, index) in comments" :key="index">
                {{ comment.text }}
                <button @click="deleteComment(index)">Delete</button>
            </div>
        </div>

<div
    class="Stars"
    :style="{ '--rating': averageRating }"
    aria-label="Rating of this product is 2.3 out of 5."
  >
    <!-- Star icons or other content here -->
  </div>
      </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    newComment: '',
                    globalRating: 3,
                    tempRating: 3,
                    comments: [],
                    commentCount: 0,
                    averageRating: 0 // Average rating
                };
            },
            methods: {
                async fetchComments() {
                    try {
                        const response = await fetch('https://glorious-engine-46w6xg6xj74hjppw-3000.app.github.dev/comments');
                        if (!response.ok) throw new Error('Failed to fetch comments');
                        const data = await response.json();
                        this.comments = data.comments;
                        this.globalRating = data.globalRating || 1;
                        this.tempRating = this.globalRating;
                        this.commentCount = data.comments.length;
                        this.starClicks = data.starClicks || 0;
                        this.averageRating = data.averageRating || 0; // Update averageRating
                        console.log(data)
                    } catch (error) {
                        console.error('Error fetching comments:', error);
                    }
                },
                async addComment() {
                    if (this.newComment.trim()) {
                        try {
                            const response = await fetch('https://glorious-engine-46w6xg6xj74hjppw-3000.app.github.dev/comments', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ 
                                    text: this.newComment.trim(),
                                    rating: this.globalRating
                                })
                            });
                            if (!response.ok) throw new Error('Failed to add comment');
                            this.newComment = '';
                            await this.fetchComments();
                        } catch (error) {
                            console.error('Error adding comment:', error);
                        }
                    }
                },
                async deleteComment(index) {
                    try {
                        const response = await fetch(`https://glorious-engine-46w6xg6xj74hjppw-3000.app.github.dev/comments/${index}`, {
                            method: 'DELETE'
                        });
                        if (!response.ok) throw new Error('Failed to delete comment');
                        await this.fetchComments();
                    } catch (error) {
                        console.error('Error deleting comment:', error);
                    }
                },
                async saveGlobalRating() {
                    try {
                        const response = await fetch('https://glorious-engine-46w6xg6xj74hjppw-3000.app.github.dev/global-rating', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ rating: this.globalRating })
                        });
                        if (!response.ok) throw new Error('Failed to save global rating');
                        await this.fetchComments();
                    } catch (error) {
                        console.error('Error saving global rating:', error);
                    }
                },
                setRating(star) {
                    this.globalRating = star;
                    this.saveGlobalRating(); // Save rating to server
                },
                hoverRating(star) {
                    this.tempRating = star;
                },
                resetRating() {
                    this.tempRating = this.globalRating;
                }
            },
            mounted() {
                this.fetchComments();
            }
        });

        app.mount('#app');
    </script>
</body>
</html>
